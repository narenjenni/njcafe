<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Order • NJ Cafe — NOVA CT-inspired</title>
  <meta name="description" content="Pemesanan online: 25 menu, catatan per item, keranjang, Pesan Sekarang via email.">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <nav>
    <div class="container navbar">
      <a href="index.html" class="brand"><span class="brand-badge"></span><strong>NJ Cafe</strong></a>
      <div class="navlinks">
        <a href="index.html#plantation">Perkebunan</a>
        <a href="index.html#coffee">Kopi Kami</a>
        <a href="index.html#menu">Menu</a>
        <a href="index.html#services">Layanan</a>
        <a href="order.html" class="cta">Order</a>
      </div>
      <button id="burger" class="burger" aria-expanded="false" aria-controls="mobile">☰</button>
    </div>
    <div class="container mobilemenu" id="mobile">
      <a href="index.html#plantation">Perkebunan</a>
      <a href="index.html#coffee">Kopi Kami</a>
      <a href="index.html#menu">Menu</a>
      <a href="index.html#services">Layanan</a>
      <a href="order.html" class="cta">Order</a>
    </div>
  </nav>

  <main class="container" style="padding:18px 0">
    <section class="toolbar">
      <div class="row">
        <input id="q" class="input" placeholder="Cari menu...">
        <select id="sort" class="select">
          <option value="name-asc">A → Z</option>
          <option value="name-desc">Z → A</option>
          <option value="price-asc">Harga Terendah</option>
          <option value="price-desc">Harga Tertinggi</option>
        </select>
        <div class="tags" id="cats">
          <button data-cat="" class="tag active">Semua</button>
          <button data-cat="Minuman" class="tag">Minuman</button>
          <button data-cat="Makanan" class="tag">Makanan</button>
        </div>
        <button class="cta" onclick="openDrawer()">Buka Keranjang</button>
      </div>
      <p class="muted" style="margin-top:8px">Tambahkan catatan per item (contoh: “tidak pedas ya”).</p>
    </section>

    <div class="layout" style="margin-top:16px">
      <aside class="sidepane">
        <div class="group">
          <strong>Rentang Harga</strong>
          <div class="tags" id="priceTags" style="margin-top:8px">
            <button class="tag" data-min="0" data-max="20000">≤ 20k</button>
            <button class="tag" data-min="20001" data-max="30000">20k–30k</button>
            <button class="tag" data-min="30001" data-max="999999">≥ 30k</button>
            <button class="tag active" data-min="0" data-max="999999">Semua</button>
          </div>
        </div>
      </aside>

      <section><div id="grid" class="grid menu"></div></section>

      <aside class="cart" id="cartSide">
        <h3 style="margin:0 0 6px; font-weight:900">Keranjang <span id="countSide" class="tag">0</span></h3>
        <div id="listSide" class="list"></div>
        <div style="border-top:1px solid var(--line); padding-top:8px; margin-top:8px">
          <div class="row"><span>Subtotal</span><strong id="subSide">Rp 0</strong></div>
          <div class="row"><span>Pajak (10%)</span><strong id="taxSide">Rp 0</strong></div>
          <div class="row" style="border:none"><span style="font-weight:900">Total</span><strong id="totSide">Rp 0</strong></div>
        </div>

        <div class="tile" style="margin-top:10px">
          <div class="tags" style="gap:8px; margin-bottom:8px">
            <input id="nameSide" class="input" placeholder="Nama lengkap">
            <input id="phoneSide" class="input" placeholder="No. HP">
          </div>
          <div class="tags" style="gap:8px; margin-bottom:8px">
            <select id="typeSide" class="select">
              <option value="Dine-in">Dine-in</option><option value="Takeaway">Takeaway</option><option value="Delivery">Delivery</option>
            </select>
            <input id="addrSide" class="input" placeholder="Meja/Alamat (opsional)">
          </div>
          <textarea id="noteSide" class="textarea" rows="2" placeholder="Catatan umum (opsional)"></textarea>
        </div>

        <button class="cta" style="width:100%; margin-top:10px" onclick="sendEmailServerless(this)">Pesan Sekarang</button>
      </aside>
    </div>
  </main>

  <div class="minibar" id="minibar">
    <div>Keranjang: <strong id="miniCount">0</strong></div>
    <div class="sum" id="miniTotal">Rp 0</div>
    <button class="cta" onclick="openDrawer()">Buka</button>
  </div>

  <aside id="drawer" class="drawer" role="dialog" aria-modal="true" aria-hidden="true">
    <header><strong>Keranjang</strong><button class="button" onclick="closeDrawer()">Tutup</button></header>
    <div class="content">
      <div id="listDrawer"></div>
      <div style="border-top:1px solid var(--line); padding-top:8px; margin-top:8px">
        <div class="row"><span>Subtotal</span><strong id="subDrawer">Rp 0</strong></div>
        <div class="row"><span>Pajak (10%)</span><strong id="taxDrawer">Rp 0</strong></div>
        <div class="row" style="border:none"><span style="font-weight:900">Total</span><strong id="totDrawer">Rp 0</strong></div>
      </div>
      <div class="tile" style="margin-top:10px">
        <div class="tags" style="gap:8px; margin-bottom:8px">
          <input id="nameDrawer" class="input" placeholder="Nama lengkap">
          <input id="phoneDrawer" class="input" placeholder="No. HP">
        </div>
        <div class="tags" style="gap:8px; margin-bottom:8px">
          <select id="typeDrawer" class="select">
            <option value="Dine-in">Dine-in</option><option value="Takeaway">Takeaway</option><option value="Delivery">Delivery</option>
          </select>
          <input id="addrDrawer" class="input" placeholder="Meja/Alamat (opsional)">
        </div>
        <textarea id="noteDrawer" class="textarea" rows="2" placeholder="Catatan umum (opsional)"></textarea>
      </div>
    </div>
    <footer><button class="cta" style="width:100%" onclick="sendEmailServerless(this)">Pesan Sekarang</button></footer>
  </aside>
  <div id="mask" class="mask" onclick="closeDrawer()"></div>

  <div id="toast" class="toast">Ditambahkan ke keranjang</div>

  <script>
    // NAV
    const burger = document.getElementById('burger'); const mobile = document.getElementById('mobile');
    burger?.addEventListener('click', ()=>{ const o = mobile.style.display==='block'; mobile.style.display=o?'none':'block'; burger.setAttribute('aria-expanded', (!o).toString()); });

    // Data menu
    const MENU = [
      {id:1,name:"Espresso",price:18000,cat:"Minuman",img:"assets/menu-01.svg",ing:["Arabika single shot"]},
      {id:2,name:"Americano",price:22000,cat:"Minuman",img:"assets/menu-02.svg",ing:["Espresso","Air panas"]},
      {id:3,name:"Cappuccino",price:28000,cat:"Minuman",img:"assets/menu-03.svg",ing:["Espresso","Susu steamed","Foam"]},
      {id:4,name:"Caffè Latte",price:28000,cat:"Minuman",img:"assets/menu-04.svg",ing:["Espresso","Susu steamed"]},
      {id:5,name:"Caramel Macchiato",price:32000,cat:"Minuman",img:"assets/menu-05.svg",ing:["Espresso","Susu","Saus karamel"]},
      {id:6,name:"Mocha",price:32000,cat:"Minuman",img:"assets/menu-06.svg",ing:["Espresso","Susu","Cokelat bubuk"]},
      {id:7,name:"Matcha Latte",price:32000,cat:"Minuman",img:"assets/menu-07.svg",ing:["Matcha","Susu"]},
      {id:8,name:"Chocolate",price:28000,cat:"Minuman",img:"assets/menu-08.svg",ing:["Cokelat bubuk","Susu"]},
      {id:9,name:"Thai Tea",price:24000,cat:"Minuman",img:"assets/menu-09.svg",ing:["Teh Thailand","Susu kental"]},
      {id:10,name:"Lemon Tea",price:20000,cat:"Minuman",img:"assets/menu-10.svg",ing:["Teh","Lemon segar"]},
      {id:11,name:"Iced Lychee Tea",price:26000,cat:"Minuman",img:"assets/menu-11.svg",ing:["Teh","Leci","Es batu"]},
      {id:12,name:"Strawberry Smoothie",price:30000,cat:"Minuman",img:"assets/menu-12.svg",ing:["Stroberi","Yogurt/susu","Es"]},
      {id:13,name:"Mango Smoothie",price:30000,cat:"Minuman",img:"assets/menu-13.svg",ing:["Mangga","Yogurt/susu","Es"]},
      {id:14,name:"Croissant",price:18000,cat:"Makanan",img:"assets/menu-14.svg",ing:["Adonan butter berlapis"]},
      {id:15,name:"Donut Glaze",price:12000,cat:"Makanan",img:"assets/menu-15.svg",ing:["Donat kentang","Glaze gula"]},
      {id:16,name:"French Fries",price:20000,cat:"Makanan",img:"assets/menu-16.svg",ing:["Kentang","Garam","Minyak"]},
      {id:17,name:"Chicken Wings (6pcs)",price:38000,cat:"Makanan",img:"assets/menu-17.svg",ing:["Sayap ayam","Marinade pedas"]},
      {id:18,name:"Spaghetti Bolognese",price:38000,cat:"Makanan",img:"assets/menu-18.svg",ing:["Tomat","Daging sapi cincang","Herbs"]},
      {id:19,name:"Spaghetti Aglio e Olio",price:34000,cat:"Makanan",img:"assets/menu-19.svg",ing:["Bawang putih","Cabai","Olive oil","Peterseli"]},
      {id:20,name:"Chicken Katsu Rice Bowl",price:38000,cat:"Makanan",img:"assets/menu-20.svg",ing:["Ayam fillet","Tepung roti","Nasi","Saus"]},
      {id:21,name:"Beef Teriyaki Rice Bowl",price:42000,cat:"Makanan",img:"assets/menu-21.svg",ing:["Daging sapi","Saus teriyaki","Nasi","Bawang bombay"]},
      {id:22,name:"Caesar Salad",price:32000,cat:"Makanan",img:"assets/menu-22.svg",ing:["Lettuce","Crouton","Parmesan","Dressing"]},
      {id:23,name:"Club Sandwich",price:34000,cat:"Makanan",img:"assets/menu-23.svg",ing:["Roti panggang","Dada ayam","Telur","Lettuce","Tomat"]},
      {id:24,name:"Waffle Maple",price:28000,cat:"Makanan",img:"assets/menu-24.svg",ing:["Adonan waffle","Maple syrup"]},
      {id:25,name:"Brownies",price:22000,cat:"Makanan",img:"assets/menu-25.svg",ing:["Cokelat","Mentega","Telur","Tepung"]},
    ];
    const TAX = .10;
    const fmt = n => new Intl.NumberFormat('id-ID',{style:'currency',currency:'IDR',maximumFractionDigits:0}).format(n).replace(",00","");

    // State & refs
    let cart = JSON.parse(localStorage.getItem('njcafe_cart') || '[]');
    const save = ()=> localStorage.setItem('njcafe_cart', JSON.stringify(cart));
    const keyOf = (id,note)=> id+'|'+(note||'');
    const grid = document.getElementById('grid'); const q=document.getElementById('q'); const sort=document.getElementById('sort'); const cats=document.getElementById('cats'); const priceTags=document.getElementById('priceTags');
    const minibar=document.getElementById('minibar'); const miniCount=document.getElementById('miniCount'); const miniTotal=document.getElementById('miniTotal');
    const side={ list:document.getElementById('listSide'), sub:document.getElementById('subSide'), tax:document.getElementById('taxSide'), tot:document.getElementById('totSide'), count:document.getElementById('countSide') };
    const draw={ list:document.getElementById('listDrawer'), sub:document.getElementById('subDrawer'), tax:document.getElementById('taxDrawer'), tot:document.getElementById('totDrawer'), count:document.getElementById('countDrawer') };
    let currentCat=""; let priceMin=0, priceMax=999999;

    function renderItems(){
      const query=(q.value||'').toLowerCase();
      const arr = MENU.filter(m => (!query || m.name.toLowerCase().includes(query)) && (!currentCat || m.cat===currentCat) && (m.price>=priceMin && m.price<=priceMax));
      switch(sort.value){
        case 'price-asc': arr.sort((a,b)=>a.price-b.price); break;
        case 'price-desc': arr.sort((a,b)=>b.price-a.price); break;
        case 'name-asc': arr.sort((a,b)=>a.name.localeCompare(b.name)); break;
        case 'name-desc': arr.sort((a,b)=>b.name.localeCompare(a.name)); break;
      }
      grid.innerHTML='';
      arr.forEach(it => {
        const el = document.createElement('article'); el.className='card';
        el.innerHTML = `
          <div style="position:relative">
            <img src="${it.img}" alt="${it.name}"><span class="pill">${it.cat}</span>
          </div>
          <div class="pad">
            <div style="display:flex; justify-content:space-between; gap:10px">
              <div><strong style="font-size:18px">${it.name}</strong><div class="muted" style="font-size:13px">Bahan: ${it.ing.join(', ')}</div></div>
              <div class="price">${fmt(it.price)}</div>
            </div>
            <textarea rows="2" class="textarea" placeholder='contoh: "tidak pedas ya"'></textarea>
            <div style="display:grid; grid-template-columns:auto 1fr auto; gap:8px; align-items:center; margin-top:8px">
              <button class="button" data-act="minus">−</button>
              <input type="number" value="1" min="1" class="input" style="text-align:center">
              <button class="button" data-act="plus">+</button>
              <button class="cta" style="grid-column:1 / -1" data-act="add">Tambah</button>
            </div>
          </div>`;
        grid.appendChild(el);
        const qty = el.querySelector('input[type="number"]');
        el.querySelector('[data-act="minus"]').addEventListener('click', ()=> qty.value = Math.max(1, parseInt(qty.value||'1',10)-1));
        el.querySelector('[data-act="plus"]').addEventListener('click',  ()=> qty.value = Math.max(1, parseInt(qty.value||'1',10)+1));
        el.querySelector('[data-act="add"]').addEventListener('click',  ()=> { addToCart(it, Math.max(1,parseInt(qty.value||'1',10)), el.querySelector('textarea').value.trim()); toast('Ditambahkan ke keranjang'); });
      });
    }

    function addToCart(it, qty, note){ const k=keyOf(it.id,note); const f=cart.find(x=>x.key===k); if(f) f.qty+=qty; else cart.push({key:k,id:it.id,name:it.name,price:it.price,qty,note}); save(); renderCart(); }
    function rm(k){ cart=cart.filter(x=>x.key!==k); save(); renderCart(); }
    function qd(k,d){ const f=cart.find(x=>x.key===k); if(!f) return; f.qty=Math.max(1,f.qty+d); save(); renderCart(); }
    function count(){ return cart.reduce((a,c)=>a+c.qty,0); }
    function subtotal(){ return cart.reduce((a,c)=>a+c.price*c.qty,0); }

    function renderCart(){
      let sub=subtotal(); const tax=Math.round(sub*.10), tot=sub+tax;
      const row=c=>`<div class="row">
        <div style="min-width:0">
          <div style="font-weight:800">${c.name} × ${c.qty} <span class="muted" style="font-size:12px">• ${fmt(c.price)}</span></div>
          ${c.note?`<div class="muted" style="font-size:13px; margin-top:4px">Catatan: ${c.note}</div>`:''}
        </div>
        <div style="display:flex; gap:6px">
          <button class="button" onclick='qd("${c.key}",-1)'>−</button>
          <button class="button" onclick='qd("${c.key}",1)'>+</button>
          <button class="button" onclick='rm("${c.key}")'>✕</button>
        </div>
      </div>`;
      const rows = cart.map(row).join('') || `<div class="muted">Belum ada item.</div>`;
      side.list.innerHTML=rows; draw.list.innerHTML=rows;
      side.sub.textContent=fmt(sub); side.tax.textContent=fmt(tax); side.tot.textContent=fmt(tot); side.count.textContent=count();
      draw.sub.textContent=fmt(sub); draw.tax.textContent=fmt(tax); draw.tot.textContent=fmt(tot); draw.count.textContent=count();
      miniCount.textContent=count(); miniTotal.textContent=fmt(tot); minibar.style.display = count()? 'flex':'none';
    }
    window.rm=rm; window.qd=qd;

    // Drawer
    const drawer=document.getElementById('drawer'); const mask=document.getElementById('mask');
    function openDrawer(){ drawer.classList.add('open'); mask.style.display='block'; }
    function closeDrawer(){ drawer.classList.remove('open'); mask.style.display='none'; }
    window.openDrawer=openDrawer; window.closeDrawer=closeDrawer;

    // Filters
    q.addEventListener('input', renderItems);
    sort.addEventListener('change', renderItems);
    cats.addEventListener('click', e=>{ const b=e.target.closest('button[data-cat]'); if(!b) return; cats.querySelectorAll('button').forEach(x=>x.classList.remove('active')); b.classList.add('active'); currentCat=b.dataset.cat||''; renderItems(); });
    priceTags.addEventListener('click', e=>{ const b=e.target.closest('button.tag'); if(!b) return; priceTags.querySelectorAll('button').forEach(x=>x.classList.remove('active')); b.classList.add('active'); priceMin=parseInt(b.dataset.min); priceMax=parseInt(b.dataset.max); renderItems(); });

    // Toast
    const toastEl=document.getElementById('toast'); function toast(m){ toastEl.textContent=m; toastEl.classList.add('show'); setTimeout(()=>toastEl.classList.remove('show'),1200); }

    // Checkout helpers
    function rf(id){ return (document.getElementById(id+'Drawer')?.value?.trim?.() || document.getElementById(id+'Side')?.value?.trim?.() || ''); }
    function requireOrder(){ if(!cart.length){ alert('Keranjang masih kosong.'); return false; } if(!rf('name')||!rf('phone')){ alert('Isi nama & nomor HP terlebih dahulu.'); return false; } return true; }
    function buildMessage(){
      const lines=[];
      lines.push('NJ Cafe — Pesanan Baru'); lines.push('========================');
      lines.push('Pelanggan : '+rf('name')); lines.push('No. HP    : '+rf('phone'));
      lines.push('Tipe      : '+(rf('type')||'Dine-in')); if(rf('addr')) lines.push('Alamat/Meja: '+rf('addr')); if(rf('note')) lines.push('Catatan   : '+rf('note'));
      lines.push(''); lines.push('Item:');
      cart.forEach((c,i)=>{ lines.push((i+1)+'. '+c.name+' × '+c.qty+' — '+fmt(c.price*c.qty)); if(c.note) lines.push('   • Catatan: '+c.note); });
      lines.push(''); lines.push('Subtotal : '+side.sub.textContent); lines.push('Pajak 10%: '+side.tax.textContent); lines.push('TOTAL    : '+side.tot.textContent);
      lines.push(''); lines.push('Waktu    : '+new Date().toLocaleString('id-ID')); lines.push('========================'); return lines.join('\n');
    }

    async function sendEmailServerless(btn){
      if(!requireOrder()) return;
      const original=btn.textContent; btn.textContent='Mengirim...'; btn.disabled=true;
      try{
        const subject='Pesanan NJ Cafe — '+rf('name'); const text=buildMessage();
        const res=await fetch('/api/send-email',{method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ to:'narenskii@gmail.com', subject, text })});
        if(!res.ok) throw new Error(await res.text()||('HTTP '+res.status));
        alert('Pesanan terkirim ke email. Terima kasih!');
      }catch(e){ alert('Gagal mengirim email: '+(e && e.message ? e.message : e)); }
      finally{ btn.textContent='Pesan Sekarang'; btn.disabled=false; }
    }
    window.sendEmailServerless=sendEmailServerless;

    // Init
    renderItems(); renderCart();
  </script>
</body>
</html>
